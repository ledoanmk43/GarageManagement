CREATE DATABASE GARAGEMANAGEMENT

USE GARAGEMANAGEMENT

CREATE TABLE KHOGARAGE
(
CARNUMBER NVARCHAR(20) NOT NULL,
IDITEM VARCHAR(50) NOT NULL, 
ITEM NVARCHAR(50) NULL,
SLITEM INT DEFAULT 0 NULL
)
ALTER TABLE KHOGARAGE
ADD CONSTRAINT PK_KHOGARAGE PRIMARY KEY (CARNUMBER, IDITEM)

CREATE TABLE HOSOKHACHHANG
(
ID VARCHAR(50) NOT NULL,
CUSTOMERNAME NVARCHAR(100) NOT NULL,
CARNUMBER NVARCHAR(20) NOT NULL,
CARBRAND NVARCHAR(50) NOT NULL,
ADDRESS NVARCHAR(100) NOT NULL,
PHONE VARCHAR(20) NOT NULL,
CREATEDDATE DATE NOT NULL,
DEBT MONEY DEFAULT 0 NOT NULL
)
ALTER TABLE HOSOKHACHHANG
ADD CONSTRAINT PK_HOSOKHACHHANG PRIMARY KEY (ID, CARNUMBER)

CREATE TABLE PHIEUSUACHUA
(
IDPSC VARCHAR(50)  NOT NULL,
CARNUMBER NVARCHAR(20)  NOT NULL,
DETAIL NVARCHAR(2000) NOT NULL,	
IDITEM VARCHAR(50) NOT NULL, 
SLITEM INT DEFAULT 0 NULL,
CREATEDDATE DATE NOT NULL,
DONGIA MONEY NULL,
TIENCONG MONEY NOT NULL,
TOTAL MONEY NOT NULL	
)
ALTER TABLE PHIEUSUACHUA
ADD CONSTRAINT PK_PHIEUSUACHUA PRIMARY KEY (IDPSC, CARNUMBER, IDITEM)
ALTER TABLE PHIEUSUACHUA
ADD CONSTRAINT FK_HOSOKHACHHANG_PHIEUSUACHUA FOREIGN KEY (IDPSC, CARNUMBER) REFERENCES HOSOKHACHHANG(ID, CARNUMBER)
ALTER TABLE PHIEUSUACHUA
ADD CONSTRAINT FK_PHIEUSUACHUA_KHOGARAGE FOREIGN KEY (CARNUMBER, IDITEM) REFERENCES KHOGARAGE(CARNUMBER, IDITEM)

CREATE TABLE PHIEUTHUTIEN
(
IDPTT VARCHAR(50)  NOT NULL,
CUSTOMERNAME NVARCHAR(100) NOT NULL,
CARNUMBER NVARCHAR(20) NOT NULL,
IDITEM VARCHAR(50) NOT NULL, 
SLITEM INT DEFAULT 0 NULL,
PHONE VARCHAR(20) NOT NULL,
EMAIL NVARCHAR(50) NULL,
CREATEDDATE DATE NOT NULL,
SOTIENTHU MONEY NOT NULL,
DEBT MONEY NOT NULL
)
ALTER TABLE PHIEUTHUTIEN
ADD CONSTRAINT PK_PHIEUTHUTIEN PRIMARY KEY (IDPTT, CARNUMBER, IDITEM)
ALTER TABLE PHIEUTHUTIEN
ADD CONSTRAINT FK_HOSOKHACHHANG_PHIEUTHUTIEN FOREIGN KEY (IDPTT, CARNUMBER) REFERENCES HOSOKHACHHANG(ID, CARNUMBER)
ALTER TABLE PHIEUTHUTIEN
ADD CONSTRAINT FK_PHIEUSUACHUA_PHIEUTHUTIEN FOREIGN KEY (IDPTT, CARNUMBER, IDITEM) REFERENCES PHIEUSUACHUA(IDPSC, CARNUMBER, IDITEM)

CREATE TABLE STAFF
(
	ID VARCHAR(50) NOT NULL,
	FULLNAME NVARCHAR(100) NOT NULL,
	BIRTHDAY DATE NULL,
	ADDRESS NVARCHAR(100) NOT NULL,
	SEX NVARCHAR(10) CHECK  (SEX = N'NAM' OR SEX = N'NỮ') NOT NULL,
	PHONE VARCHAR(20) NOT NULL,
	BASICSALARY MONEY NOT NULL,
	ADDITIONALSALARY MONEY NULL,
	TOTALSALARY MONEY NULL
)
ALTER TABLE STAFF
ADD CONSTRAINT PK_STAFF PRIMARY KEY (ID)


CREATE TABLE PASSWORD
(
	ID VARCHAR(50) NOT NULL,
	USERNAME NVARCHAR(20) NOT NULL,
	PASS NVARCHAR(100) NOT NULL,
	ACCESSLEVEL INT NOT NULL
)
ALTER TABLE PASSWORD
ADD CONSTRAINT PK_PASSWORD PRIMARY KEY(ID, USERNAME)
ALTER TABLE PASSWORD
ADD CONSTRAINT FK_PASSWORD_STAFF FOREIGN KEY (ID) REFERENCES STAFF(ID)

insert into STAFF values ('1', 'Administrator', '08/07/1999', 'KTXzoneB', N'NAM', '0909545454', 9000000, 3000000, 12000000)
insert into STAFF values ('2', 'Staff user', '12/12/2000', 'Q5', N'NỮ', '0909595959', 6000000, 1500000, 7500000)
delete PASSWORD
insert into PASSWORD values ('1', 'admin', '1', 1)
insert into PASSWORD values ('2', 'user', '2', 0)

CREATE PROC USP_GetAccountByUsername
@userName NVARCHAR(20)
AS 
BEGIN
SELECT * FROM PASSWORD WHERE USERNAME = @userName 
END

CREATE PROC USP_Login
@userName NVARCHAR(20), @passWord NVARCHAR(100)
AS 
BEGIN
SELECT * FROM PASSWORD WHERE USERNAME = @userName AND PASS = @passWord
END

